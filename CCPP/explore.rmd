---
title: "BDA - Project"
authors: "Khang Nguyen, Son Le"
output:
  pdf_document:
    toc: yes
    toc_depth: 1
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# loading packages
library(brms)
library(readxl) # from tidyverse package
library(rstan)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
library(bayesplot)
theme_set(bayesplot::theme_default())
library(rprojroot)
library(corrplot)
root<-has_file("explore.rmd")$make_fix_file()
```

Data loading

```{r}
powerplant <- read_excel("Folds5x2_pp.xlsx")
powerplant <- as.data.frame(scale(powerplant))
head(powerplant)
corrplot(cor(powerplant), method="number")
```

Model fitting

```{r}
fit1 <- brm(bf(PE ~ .), powerplant) # bf is formula (PE ~ AT + AP + P + RH), dot means every other param
fit1 <- add_criterion(fit1, "loo")
# DONT RUN THE TWO FITS BELOW, takes a very long time
fit2 <- brm(bf(PE ~ s(AT)), powerplant)
fit2 <- add_criterion(fit2, "loo")
fit3 <- brm(bf(PE ~ s(AT) + s(V)), powerplant, cores=4)
fit3 <- add_criterion(fit3, "loo")
```

The Stan code

```{r}
code_brm_linear <- stancode(fit1)
data_brm_linear <- standata(fit1)
```

Model evaluation

```{r}
pp_check(fit1)
pp_check(fit2)
pp_check(fit3)
loo(fit1)
loo(fit2)
loo(fit3)
loo_compare(fit1, fit2, fit3)
plot(conditional_effects(fit1), points = TRUE)
plot(conditional_effects(fit2), points = TRUE)
plot(conditional_effects(fit3), points = TRUE)
```